<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Custom regularizers · RegularizedOptimization.jl</title><meta name="title" content="Custom regularizers · RegularizedOptimization.jl"/><meta property="og:title" content="Custom regularizers · RegularizedOptimization.jl"/><meta property="twitter:title" content="Custom regularizers · RegularizedOptimization.jl"/><meta name="description" content="Documentation for RegularizedOptimization.jl."/><meta property="og:description" content="Documentation for RegularizedOptimization.jl."/><meta property="twitter:description" content="Documentation for RegularizedOptimization.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="RegularizedOptimization.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">RegularizedOptimization.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../algorithms/">Algorithms</a></li><li><a class="tocitem" href="../../regularizers/">Regularizers</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../basic/">A regularized optimization problem</a></li><li><a class="tocitem" href="../ls/">A regularized least-square problem</a></li><li class="is-active"><a class="tocitem" href>Custom regularizers</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li><li><a class="tocitem" href="../../bibliography/">Bibliography</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Custom regularizers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Custom regularizers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaSmoothOptimizers/RegularizedOptimization.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaSmoothOptimizers/RegularizedOptimization.jl/blob/master/docs/src/examples/custom_regularizer.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Custom-regularizers"><a class="docs-heading-anchor" href="#Custom-regularizers">Custom regularizers</a><a id="Custom-regularizers-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-regularizers" title="Permalink"></a></h1><p>In the case where the regularizer for your application is not already implemented you can still implement one yourself and use our solvers. In this tutorial we are going to model the (nonsmooth) function</p><p class="math-container">\[h : \mathbb{R}^n \mapsto \mathbb{R} \cup \{\infty\} : x \mapsto \chi(x; \mathbb{B}_\infty)\]</p><p>where <span>$\chi(\cdot; A)$</span> is the indicator function on the set <span>$A$</span> and <span>$\mathbb{B}_\infty$</span> is the unit ball in the infinity norm, i.e,</p><p class="math-container">\[\chi(x; \mathbb{B}_\infty) = 
\begin{cases}
0 &amp; \text{if } \|x\|_\infty \leq 1,\\
\infty &amp; \text{otherwise}.
\end{cases}\]</p><pre><code class="language-julia hljs">using LinearAlgebra
using ShiftedProximalOperators
using RegularizedProblems
using RegularizedOptimization

# First we create a type for our indicator function
struct SimpleIndicator end

# Then, we add a evaluation function
function (h::SimpleIndicator)(x)
  return norm(x, Inf) &lt;= 1 ? 0.0 : Inf
end

# Now, we add a type that represents the function t -&gt; h(shift + t)
mutable struct ShiftedSimpleIndicator{V} &lt;: ShiftedProximableFunction
  shift::V
  temp::V
end

# Add the evaluation function for the shifted type
function (ψ::ShiftedSimpleIndicator)(x)
  @. ψ.temp = ψ.shift + x
  return norm(ψ.temp, Inf) &lt;= 1 ? 0.0 : Inf
end

# Add the shifted function
function ShiftedProximalOperators.shifted(h::SimpleIndicator, xk::Vector{T}) where{T}
  return ShiftedSimpleIndicator(xk, similar(xk))
end

# Add the shift! function
function ShiftedProximalOperators.shift!(ψ::ShiftedSimpleIndicator{Vector{T}}, xk::Vector{T}) where{T}
  ψ.shift .= xk
end

# Add the prox! function for both the unshifted and shifted types, we can solve the proximal problem analytically by hand.
function ShiftedProximalOperators.prox!(
  y::AbstractVector{T},
  h::SimpleIndicator,
  q::AbstractVector{T},
  σ::T,
) where{T}
  for i ∈ eachindex(y)
    y[i] = min(max(q[i], -1), 1)
  end
end

function ShiftedProximalOperators.prox!(
  y::AbstractVector{T},
  ψ::ShiftedSimpleIndicator{Vector{T}},
  q::AbstractVector{T},
  σ::T,
) where{T}
  for i ∈ eachindex(y)
    y[i] = min(max(q[i], -1 - ψ.shift[i]), 1 - ψ.shift[i])
  end
end

# We can try to use this new regularizer with R2 :

# define a small smooth problem
using ADNLPModels
f_model = ADNLPModel(x -&gt; (x[1] - 4)^2, 3*ones(1), name = &quot;Simple quadratic model&quot;)
h = SimpleIndicator()
regularized_nlp = RegularizedNLPModel(f_model, h)

out = R2(regularized_nlp, verbose = 1)
println(&quot;R2 converged after $(out.iter) iterations to the solution x = $(out.solution)&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr36"><span class="sgr1">[ Info: </span></span>R2: finding initial guess where nonsmooth term is finite
<span class="sgr36"><span class="sgr1">[ Info: </span></span>  iter     f(x)     h(x)   √(ξ/ν)        ρ        σ      ‖x‖      ‖s‖ R2
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     0  9.0e+00  0.0e+00  1.7e-06  9.0e+00  1.4e+03  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     1  9.0e+00  0.0e+00  1.0e-06  9.0e+00  4.5e+02  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     2  9.0e+00  0.0e+00  5.8e-07  9.0e+00  1.5e+02  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     3  9.0e+00  0.0e+00  3.3e-07  9.0e+00  5.0e+01  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     4  9.0e+00  0.0e+00  1.9e-07  9.0e+00  1.7e+01  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     5  9.0e+00  0.0e+00  1.1e-07  9.0e+00  5.6e+00  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     6  9.0e+00  0.0e+00  6.4e-08  9.0e+00  1.9e+00  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     7  9.0e+00  0.0e+00  3.7e-08  9.0e+00  6.2e-01  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     8  9.0e+00  0.0e+00  2.1e-08  9.0e+00  2.1e-01  1.0e+00  0.0e+00 ↘
<span class="sgr36"><span class="sgr1">[ Info: </span></span>     9  9.0e+00  0.0e+00  1.2e-08  9.0e+00  6.9e-02  1.0e+00  0.0e+00
<span class="sgr36"><span class="sgr1">[ Info: </span></span>R2: terminating with √(ξ/ν) = 1.2346118581657121e-8
R2 converged after 9 iterations to the solution x = [1.0]</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ls/">« A regularized least-square problem</a><a class="docs-footer-nextpage" href="../../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 1 October 2025 13:02">Wednesday 1 October 2025</span>. Using Julia version 1.11.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
